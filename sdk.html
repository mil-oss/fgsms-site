<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 24 Feb 2017 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170224" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Fine Grained Service Monitoring System &#x2013; FGSMS SDK Introduction</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
                      <a href="https://github.com/mil-oss/fgsms">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
        alt="Fork me on GitHub">
    </a>
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="http://mil-oss.org/" id="bannerLeft"><img src="images/mil-oss-logo.png"  alt="Fine Grained Service Monitoring System"/></a></div>
        <div class="pull-right"><div id="bannerRight"><img src="images/fgsms_logo_small.png" /></div>
</div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="projectVersion">Version: 7.0.0-SNAPSHOT<span class="divider">|</span></li>
        <li class=""><a href="https://www.mil-oss.org" class="externalLink" title="MIL-OSS">MIL-OSS</a><span class="divider">/</span></li>
    <li class="active ">FGSMS SDK Introduction</li>
        <li id="publishDate" class="pull-right">Last Published: 24 Feb 2017</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
      <li><a href="index.html" title="Project Information"><span class="none"></span>Project Information</a>  </li>
    <li><a href="index2.html" title="Welcome"><span class="none"></span>Welcome</a>  </li>
    <li><a href="whitepaper.html" title="Whitepaper"><span class="none"></span>Whitepaper</a>  </li>
    <li><a href="architecture.html" title="Architecture"><span class="none"></span>Architecture</a>  </li>
    <li><a href="quickstart.html" title="Quick Start"><span class="none"></span>Quick Start</a>  </li>
    <li><a href="deployment-planning.html" title="Deployment Planning"><span class="none"></span>Deployment Planning</a>  </li>
    <li><a href="deployserver.html" title="Deploying the Server"><span class="none"></span>Deploying the Server</a>  </li>
    <li><a href="agentmatrix.html" title="Agent Matrix"><span class="none"></span>Agent Matrix</a>  </li>
    <li><a href="deployagent.html" title="Deploying Agents"><span class="none"></span>Deploying Agents</a>  </li>
    <li><a href="user.html" title="User Guide"><span class="none"></span>User Guide</a>  </li>
    <li><a href="reporting.html" title="Reports and data access"><span class="none"></span>Reports and data access</a>  </li>
    <li><a href="security.html" title="Security Guide"><span class="none"></span>Security Guide</a>  </li>
    <li><a href="permissions.html" title="Access Control"><span class="none"></span>Access Control</a>  </li>
    <li><a href="federation.html" title="Data Federation"><span class="none"></span>Data Federation</a>  </li>
    <li><a href="news.html" title="News"><span class="none"></span>News</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>SDK</a>
  </li>
    <li><a href="specs.html" title="Specs/ICD"><span class="none"></span>Specs/ICD</a>  </li>
    <li><a href="committer.html" title="Committers"><span class="none"></span>Committers</a>  </li>
    <li><a href="faq.html" title="FAQ"><span class="none"></span>FAQ</a>  </li>
            <li class="nav-header">Modules</li>
    <li><a href="../../tomcat/index.html" title="Pre-Configured Apache Tomcat"><span class="none"></span>Pre-Configured Apache Tomcat</a>  </li>
    <li><a href="../../juddi-fgsms/index.html" title="Pre-Configured Apache Juddi"><span class="none"></span>Pre-Configured Apache Juddi</a>  </li>
    <li><a href="fgsms-common-interfaces/index.html" title="fgsms Interfaces WS Stubs and Schema Bindings Generated from WSDL"><span class="none"></span>fgsms Interfaces WS Stubs and Schema Bindings Generated from WSDL</a>  </li>
    <li><a href="fgsms-common/index.html" title="fgsms Common"><span class="none"></span>fgsms Common</a>  </li>
    <li><a href="fgsms-agents/index.html" title="fgsms Embedded Agents"><span class="none"></span>fgsms Embedded Agents</a>  </li>
    <li><a href="fgsms-ws-notification/index.html" title="fgsms WS-Notification Parent"><span class="none"></span>fgsms WS-Notification Parent</a>  </li>
    <li><a href="fgsms-server/index.html" title="fgsms Server"><span class="none"></span>fgsms Server</a>  </li>
    <li><a href="fgsms-cli/index.html" title="fgsms Command Line Interface"><span class="none"></span>fgsms Command Line Interface</a>  </li>
    <li><a href="fgsms-samples/index.html" title="fgsms Examples Packages"><span class="none"></span>fgsms Examples Packages</a>  </li>
    <li><a href="fgsms-dist/index.html" title="fgsms Distribution"><span class="none"></span>fgsms Distribution</a>  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
<form id="search-form" action="https://www.google.com/search" method="get" >
      <input value="https://mil-oss.github.io/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript">asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>FGSMS SDK Introduction</h1>
<div class="section">
<div class="section">
<h3><a name="NOTICE:_This_article_is_a_work_in_process._It_may_be_inaccurate_or_unclear._Pull_requests_welcome."></a>NOTICE: This article is a work in process. It may be inaccurate or unclear. Pull requests welcome.</h3>
<p>FGSMS has a number of extensibility points. This article discusses how use some of those built in extensibility points to create plugins, effectively extending FGSMS. Also discussed is the Command Line Interface (CLI) app, making custom agents, interacting with the FGSMS SOAP services and some of the sample plugins that in the source base for FSGSM. Finally, the guts of the FGSMS database is discussed along with examples on exporting data for running your own queries, reports, number crunching, etc.</p>
<h1>FGSMS Example Apps and the CLI</h1>
<p>FGSMS comes with an Example &#x201c;SDK&#x201d; application, which enables you to perform a number of tasks that are not easy to do in the UI, such as bulk operations.</p></div></div>
<div class="section">
<h2><a name="Whats_Included"></a>What&#x2019;s Included?</h2>
<p>As a job aid, a sample console application simply named, FGSMS.CLI provides access to the FGSMS services. To access it, build the project using maven (or use the version included with the distro) from the samples/FGSMS.SDK folder, then run it, entering a username and password to access the server. Note: PKI/CAC authentication is not currently supported by the FGSMS.SDK console app</p>
<h1>FGSMS&#x2019;s extensibility points</h1>
<p>FGSMS provides a number of extensibility points, plus you&#x2019;re free to directly access the XML SOAP web services. The rest of this articles focuses on the following.</p>

<ul>
  
<li>How to create your own SLA Rules and Actions</li>
  
<li>How to extend or write your own FGSMS web service</li>
  
<li>How to create your own agents</li>
  
<li>How to programmatically export data</li>
  
<li>How to write your own application to receive alerts</li>
  
<li>How to write your own federation target</li>
</ul></div>
<div class="section">
<h2><a name="Extended_Service_Level_Agreements"></a>Extended Service Level Agreements</h2>
<p>FGSMS defines an SLA as a set of <a href="apidocs/org/miloss/fgsms/services/interfaces/policyconfiguration/SLARuleGeneric.html">rules</a> that can be evaluated to true or false that represent some condition that requires an <a href="apidocs/org/miloss/fgsms/services/interfaces/policyconfiguration/SLAAction.html">actions</a> to be triggered.</p>
<p>Each rule must implement the <a href="apidocs/org/miloss/fgsms/plugins/sla/SLARuleInterface.html"> SLA Rule Interface</a> and each Action must implement the <a href="apidocs/org/miloss/fgsms/plugins/sla/SLAActionInterface.html">SLA Action Interface</a>.</p>
<p>Each action and rule set must also be also be registered in the Configuration Database. Registration is processed via the UI or via web service.</p>
<p>Each rule and action is also responsible for providing help information to the user which defines what configuration settings are required on a per service, per SLA basis, validation rules. Globally define settings can also be used.</p>
<p>Each rule has a <tt>appliesTo</tt> method, which defines whether or not this rule can process data of a given <a href="apidocs/org/miloss/fgsms/services/interfaces/policyconfiguration/ServicePolicy.html">service policy</a>.</p>
<div class="section">
<h3><a name="Sample_Project_maven_based"></a>Sample Project (maven based)</h3>
<p>In your favorite IDE and build system, create a new JAR project</p>
<p>Required dependencies:</p>

<ul>
  
<li>groupId: <tt>org.mil-oss</tt> artifactId: <tt>fgsms-common-interfaces</tt> scope: <tt>provided</tt></li>
  
<li>groupId: <tt>org.mil-oss</tt> artifactId: <tt>fgsms-common</tt> scope: <tt>provided</tt></li>
</ul>
<p>Add a class and have it implement one of the following:</p>

<ul>
  
<li>SLA Action: org.miloss.fgsms.plugins.sla.SLAActionInterface</li>
  
<li>SLA Rule: org.miloss.fgsms.plugins.sla.SLARuleInterface</li>
</ul>
<p>Practical example: <a class="externalLink" href="https://github.com/mil-oss/fgsms/tree/master/samples/fgsms.Examples.SLAPlugin">Example SLA Plugin</a></p></div>
<div class="section">
<h3><a name="How_to_deploy_it"></a>How to deploy it</h3>

<ol style="list-style-type: decimal">
  
<li>Stop Tomcat</li>
  
<li>Copy the jar, along with any other dependencies to the following location: <tt>tomcat/webapps/fgsmsServices/WEB-INF/lib</tt></li>
  
<li>Start Tomcat</li>
</ol>
<p>If your instanced is clustered or load balanced, make sure you repeat this for all FGSMS servers.</p></div>
<div class="section">
<h3><a name="How_to_register_the_plugin"></a>How to register the plugin</h3>
<p>Each plugin must be registered in the database</p>
<p>Note: this will eventually be web enabled but for now</p>
<p>Register your plugin in the database via psql</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">psql
\c fgsms_config
INSERT INTO plugins(  classname, displayname,appliesto)    VALUES ('your.package.Classname', 'A title for your plugin','type');`
</pre></div></div>
<p>where <tt>type</tt> MUST be one of the following  - SLA_ACTION  - SLA_RULE  - FEDERATION_PUBLISH</p></div>
<div class="section">
<h3><a name="Attaching_it_to_a_service_policy_for_testing."></a>Attaching it to a service policy for testing.</h3>
<p>TODO</p></div>
<div class="section">
<h3><a name="Noteable_APIs"></a>Noteable APIs</h3>
<div class="section">
<h4><a name="org.miloss.fgsms.common.DBSettingsLoader"></a>org.miloss.fgsms.common.DBSettingsLoader</h4>
<p>Usage: server side Tasks: provide access to getting and setting globally defined configuration settings from the database. From the UI: Administration &gt; General Settings Example:</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">KeyNameValueEnc settings = DBSettingsLoader.GetPropertiesFromDB(true, &quot;SDK.Samples.AlertRecieverService&quot;, &quot;URL&quot;);
if (settings != null &amp;&amp; settings.getKeyNameValue() != null &amp;&amp; settings.getKeyNameValue().getPropertyValue() != null) {
    //do something creative here
}
</pre></div></div></div>
<div class="section">
<h4><a name="org.miloss.fgsms.common.AuditLogger"></a>org.miloss.fgsms.common.AuditLogger</h4>
<p>Usage: server side Tasks: log important events to the database From the UI: Administration &gt; Audit Logs Example:</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">//MessageContext is option, but if defined and not null, the requestor's IP
//is added to the log message, usually only used from a web service call
AuditLogger.LogItem(&quot;java class&quot;, &quot;method&quot;, &quot;username&quot;, &quot;message&quot;, new SecurityWrapper(), javax.xml.ws.handler.MessageContext);
//OR
AuditLogger.LogItem(&quot;java class&quot;, &quot;method&quot;, &quot;username&quot;, &quot;message&quot;, &quot;UNCLASSIFIED&quot;, null);
</pre></div></div></div></div></div>
<div class="section">
<h2><a name="Write_your_own_federation_target"></a>Write your own federation target</h2>
<p>FGSMS defines an Federation Target as a <a href="xref/org/miloss/fgsms/plugins/federation/FederationInterface.html"> plugin</a> that is used to periodically share, transmit or otherwise publish information via some mechanism. A user with global administrator privileges can define how often this occurs. For convenience, aggergated statistics is provide</p>
<p>Currently, FGSMS provides a single federation plugin, the UDDI Publisher. On a periodic basis, it attaches statistics from the <tt>Statistics Aggregator</tt> to registered UDDI &#x2018;Binding Templates&#x2019;</p>
<div class="section">
<h3><a name="Sample_Project_maven_based"></a>Sample Project (maven based)</h3>
<p>In your favorite IDE and build system, create a new JAR project</p>
<p>Required dependencies:</p>

<ul>
  
<li>groupId: <tt>org.mil-oss</tt>, artifactId: <tt>fgsms.Common.Interfaces</tt>, scope: <tt>provided</tt></li>
  
<li>groupId: <tt>org.mil-oss</tt>, artifactId: <tt>fgsms.Common</tt> scope: <tt>provided</tt></li>
</ul>
<p>Add a class and have it implement one of the following:</p>

<ul>
  
<li>Federation Interface: <tt>org.miloss.fgsms.plugins.federation.FederationInterface</tt></li>
</ul>
<p>Practical example: <a class="externalLink" href="https://github.com/mil-oss/fgsms/tree/master/fgsms.UddiPublisher">UDDI Publisher</a></p></div>
<div class="section">
<h3><a name="How_to_deploy_it"></a>How to deploy it</h3>
<p>Follow the SLA plugin instructions.</p></div>
<div class="section">
<h3><a name="How_to_register_the_plugin"></a>How to register the plugin</h3>
<p>Follow the SLA plugin instructions.</p></div>
<div class="section">
<h3><a name="Attaching_it_to_a_service_policy_for_testing."></a>Attaching it to a service policy for testing.</h3>
<p>TODO</p></div></div>
<div class="section">
<h2><a name="Extending_an_existing_FGSMS_service"></a>Extending an existing FGSMS service</h2>
<p>The two most likely candidates for extending the FGSMS Web Services are the Data Access Service and the Reporting Service.</p>
<p>The Reporting Service&#x2019;s interface includes report types for wide array of report types, however not all of them were implemented because these specific reports did not add any valuable information or insight to service usage or simply did not have much meaning. The reports available in FGSMS represent the best ideas that were available at its inception. Surely, users will have custom needs that can be met with the available information that is recorded. Creative developers should have no problem creating and/or extending FGSMS.</p>
<p>The Data Access Service includes the capability to pull common queries from the recorded data set, such as average response time over a given date/time range. In the future, there may be custom needs for display recorded information and queries in the Web GUI. In this case, the DAS is the prime candidate for extending.</p>
<p>When extending FGSMS, always be sure to enforce the permission structure provided. For an example, see any of the FGSMS services. On each service invocation, several key actions are performed:</p>

<ul>
  
<li>Identify the requestor and log using the audit logger.</li>
  
<li>Assert that the requestor has the required permission for this method.</li>
  
<li>Validate the inbound message for correctness and classification level</li>
  
<li>Execute and format the response. Note: Always used parameterized SQL queries.</li>
  
<li>Append the defined classification level from the FGSMS database.</li>
  
<li>OperationalRecord, add the following</li>
</ul>
<p>By following the existing code patterns and by using the included utility functions, adding new functions and functionality should be fairly easy.</p>
<h1>FGSMS Agents</h1>
<p>There are a number of different types of FGSMS Agents that you can build depending on the type of &#x201c;thing&#x201d; that you wish to monitor and what kind of data you need to record.</p>
<p>There are several types:</p>

<ul>
  
<li>Transactional Service Agents, requires the monitoring of individual transactions</li>
  
<li>Status Agents, requires the monitoring of the availability of a particular component or item on a periodic basis</li>
  
<li>Statistics Agents, records statistics about a component and its status on a periodic basis</li>
  
<li>Process and Operating System agents, monitors a computer and/or processes running on the computer.</li>
</ul>
<p>Important: FGSMS uses unique URLs as an identifier for items stored within the database. When creating your own agent, ensure that the URL uniquely identifies a service on a machine. This can be accomplished with (Java, IPAddressUtility.ModifyURL, .NET MessageProcessor.ModifyURL). Port numbers and protocols must be specified</p>
<p>Example: <tt>Protocol:\\hostname:port\path</tt></p>
<p>In general, the hostname is preferred over other means if identification, such as an IP address. This is due to machines having multiple addresses. Certain services are load balanced, which means certains URL patterns can map to more than one machine.</p></div>
<div class="section">
<h2><a name="Transactional_Web_Service_Agents"></a>Transactional Web Service Agents</h2>
<p>Agents need two things in order to function, a service policy (from the PCS) and an available Data Collection Service (DCS). In other words, any custom agent must function as a web service client to the PCS and DCS as well as have the ability to obtain the required information from the framework, web service, or container of the thing that is to be monitored. The &#x201c;thing&#x201d; that we are monitoring can be anything, so long as a request and response can be paired with each other. In order to access the FGSMS services, you will need credentials with the &#x201c;agent&#x201d; role defined. In general, the process is as follows:</p>

<ul>
  
<li>Some transaction is observed</li>
  
<li>Request and cache the policy for this object from the PCS</li>
  
<li>Uses the policy to reduce and/or filter data</li>
  
<li>Send data to the DCS</li>
  
<li>Update the cached service policy as needed</li>
</ul>
<p>Normally, all of these functions are performed by the Message Processor and the associated framework behind it. The agent&#x2019;s is merely responsible for collecting the information and handing it over to the Message Processor.</p>
<p>FGSMS provides transactional agents for most XML/SOAP web service frameworks. If you have a specific need and whatever it is that you are monitoring fits into this profile, then you may wish to adapter the existing components to meet your needs.</p></div>
<div class="section">
<h2><a name="Roll_Your_Own_Transactional_Web_Service_.NET_Agent"></a>Roll Your Own (Transactional) Web Service .NET Agent</h2>
<p>The transactional agent is triggered on a per service execution basis which collects and passes information along to a thread safe Message Processor (MP) in the class named: <tt>FGSMS.Agents.MessageProcessor</tt> in <tt>FGSMS.NETAgents.dll</tt></p>
<p>The Message Processor&#x2019;s job is to obtain service policies, filter out unwanted data and to send this data to the DCS. This action is invoked in a separate running thread in order to prevent additional lag for the monitored service&#x2019;s transactions. The MessageProcessor requires you to have all of the information available at the same time (see &#x201c;ProcessMessage&#x201d; , 3 overloads). If your framework or object does not make both the request and the response available at the same time, you can use the AgentMessageTable class to use as a holder to temporarily cache the request object as long as you remove the cached data eventually.</p>
<p>If your agent also sees SOAP traffic, you must manually filter out data related to FGSMS to prevent recursive looping.</p>
<p>.NET agents load their configuration either from a specific application config file or from the machien config file. (It&#x2019;s good idea to test both scenarios).</p></div>
<div class="section">
<h2><a name="Roll_Your_Own_Transactional_Web_Service_Java_Agents"></a>Roll Your Own (Transactional) Web Service Java Agents</h2>
<p>In the Java implementation for JAX-WS based services, FGSMS agents use JAX-WS for interacting with the DCS and PCS services. </p>
<p>The agents are triggered on a per service execution basis and collect and pass information along to a thread safe Message Processor (MP). The MP&#x2019;s job is to obtain service policies, filter out unwanted data and to send this data to the DCS. This action is invoked in a separate running thread in order to prevent additional lag for the monitored service&#x2019;s transactions. </p>
<p>In Java, the MessageProcessor is located within FGSMS.AgentCore.jar</p>
<p>Recusive Looping, as a warning, all FGSMS agents MUST filter out (ignore) messages with a SOAP action that correlates to the DCS services&#x2019;s AddData. </p>
<p><tt>urn:org:miloss:fgsms:services:interfaces:dataCollector/dataCollectorService/AddData</tt></p>
<p>Not performing this task will end up with a never ending loop. As an implementation note, when running Jboss on a Windows platform, SOAPAction is reported without quotation marks. On Linux, SOAPAction is reported WITH quotation marks.</p></div>
<div class="section">
<h2><a name="Status_Agents"></a>Status Agents</h2>
<p>Status Agents can report the status of any arbitrary &#x201c;thing&#x201d; and is typically performed on a periodic basis which provides a heartbeat. Status Agents, such as the Status Bueller, report back status information to FGSMS on a periodic basis. </p>
<p>The FGSMS server contains a number of different web services, including the Status Service, which is the primary interaction point of a a status agent. In order to make your own status agent, you need to be able to:</p>

<ul>
  
<li>Determine the status of something</li>
  
<li>Determine a unique URI identifier of the something</li>
</ul>
<p>If you can get this information, then all you have to do is hand over this information to <a class="externalLink" href="http://mil-oss.github.io/fgsms/apidocs/org/miloss/fgsms/agentcore/StatusHelper.html">Status Helper</a>, which will take are of notifing the FGSMS server.</p>
<p>Reference <tt>fgsms.AgentCore.jar</tt></p></div>
<div class="section">
<h2><a name="Statistical_Brokers_Agents"></a>Statistical Brokers Agents</h2>
<p>Broker agents can either run on the FGSMS server or embedded on the same machine hosting the broker. Agents running the server store data directly to the database. Embedded agents report statistics of message brokers by providing an availability status and general statistics for queues or topics to the FGSMS Data Collector Service. </p>
<p>Please reference the <tt>fgsms.QpidPyAgent</tt> for an example of an embedded agent. Please reference the <tt>fgsms.QpidJMXAgent</tt> for an example of an agent running on the FGSMS server. Please reference the <tt>fgsms.SMX</tt> for an example of an agent running on the FGSMS server.</p></div>
<div class="section">
<h2><a name="Web_Services_as_a_Self_Reporting_Agents"></a>Web Services as a Self Reporting Agents</h2>
<p>If you, as a service developer do not wish to use any of the pre-built agents or have a unique situation and/or technology, you want to look into having your service be a self reporting agent. Essentially, this means that your service would need to be able to keep track of timing information for each public method that is executed (and that you which to report data on) and adhere to the FGSMS service policies.</p>
<p>At this stage, you would essentially be building and integrating your own embedded agent. In either case, it is recommended that you at least look at the pre-built service agents classes as examples. By following the logic, it should be fairly easy to build your own solution. The vast majority of all necessary logic is within fgsms.AgentCore.jar for Java and FGSMS.NETAgent.dll for .NET, specifically in the Message Process and the Helper classes.</p></div>
<div class="section">
<h2><a name="Making_an_agent_that_runs_within_the_FGSMS_server"></a>Making an agent that runs within the FGSMS server</h2>
<p>Making an agent that runs on the server enables you to have a few more options. Web service communication is not an issue and you&#x2019;ll have direct access to the databases. Most of the logic can be borrowed/leveraged/stolen/whatever from the existing agents and from within the Helper classes within fgsms.SLAProcessor.jar. This provides a number of the Status functions via direct database access. These same functions are mimicked in fgsms.AgentCore in various classes.</p>
<p>Here&#x2019;s a few of the server based agents.</p>

<ul>
  
<li>Apache Service Mix (uses JMX to remote connect and capture statistics)</li>
  
<li>Apache Qpid (uses JMX to remote connect and capture statistics)</li>
  
<li>Bueller (pings websites/services with HTTP GET)</li>
  
<li>HornetQ (uses JMX to remote connect and capture statistics)</li>
</ul></div>
<div class="section">
<h2><a name="Making_your_agent_work"></a>Making your agent work</h2>
<p>If order for your agent to work, it&#x2019;ll need a few things to get going.</p>

<ul>
  
<li>An fgsms-agent.properties config file (Java only) or an app/web/machine.config for .NET</li>
  
<li>Credentials for accessing the FGSMS server with the &#x201c;agent&#x201d; role. Credentials can be</li>
  
<li>Username/password (which are expected to be encrypted)</li>
  
<li>A client PKI (X509) certificate</li>
</ul>
<p>Care should be taken to help optimize memory and bandwidth usage especially when auditing a message flow (i.e. when the request and/or response is being recorded).  In the existing agents, requests for adding transactional data are packaged together into message no larger than 1 megabyte. In addition, request/response  messages, when being recorded, should be capped by adhering to the policy that is returned by the PCS. The default maximum is 1024000 bytes which means that messages larger than this should be truncated by the agent (meaning the message reported back to FGSMS, not the actual service message).</p>
<p>Agents should NEVER cause a service to fail. </p></div>
<div class="section">
<h2><a name="The_Persistent_Agent"></a>The Persistent Agent</h2>
<p>In order to support disconnected operations, FGSMS&#x2019;s agents can store collected data to disk. The stored information is encrypted. When connectivity is reestablished, this &#x201c;queue&#x201d; can then be purged. It&#x2019;s the persistent agents&#x2019;s job to monitor the offline storage location at to periodically attempt to reestablish connectivity to the FGSMS server. The persistent agent, only works for transactional web service traffic.</p></div>
<div class="section">
<h2><a name="Extending_the_Operating_System_agent"></a>Extending the Operating System agent</h2>
<p>The FGSMS OS agent uses the Hyperic SIGAR API to collect data in a generic fashion across many types of operating systems. It has a few extensibility points worth mentioning.</p>
<div class="section">
<h3><a name="Sensor_data_capture"></a>Sensor data capture</h3>
<p>The sensor interface enables you to attach sensor data to the collected machine data. Currently, there is little to no processing done on sensor data at the FGSMS server. No reports, no CSV exports, nothing. The data is simply stored there.</p>
<p>Add <tt>org.mil-oss:fgsms-os-agent</tt> as a <tt>provided</tt> dependency and implement the interface <tt>org.miloss.fgsms.osagent.sensor.ISensorProvider</tt>.</p>
<p>To run it, edit the <tt>sensor.properties</tt> files that comes with OS Agent and add your class to it. Finally, add your jar and it&#x2019;s dependencies to the classpath of the OS Agent and fire it up.</p>
<h1>Database and Stored Procedures</h1>
<p>Java implementation of FGSMS is specifically targeted for use with PostgreSQL. It may work without modification on other databases, but every DBMS is different  and modifications will most likely be necessary if porting the FGSMS to something other than PostgreSQL.</p>
<p>Currently, the only store procedures in use are triggers on the RawData table of the FGSMS Performance database which updates various tallies to speed up the user interface and Data Access Service.</p>
<p>At one point in time, some experiments were been performed to port FGSMS to Microsoft&#x2019;s SQL Server. It&#x2019;s possible but the problem lies in Postgres&#x2019;s case sensitivity and escape characters. Postgres uses double quotes where as Microsoft uses square brackets. A find and replace may solve this issue and will be considered in the future (or maybe OpenJPA).</p></div></div>
<div class="section">
<h2><a name="Programmatically_export_data"></a>Programmatically export data</h2>
<p><a class="externalLink" href="https://github.com/mil-oss/fgsms/tree/master/samples/fgsms.ExportDataFromDatabase">Exporting from the database directly</a></p>
<p><a class="externalLink" href="https://github.com/mil-oss/fgsms/tree/master/samples/fgsms.ExportDataFromViaWebService">Exporting via web service calls</a></p>
<h1>Editing the User Interface of FGSMS</h1>
<p>FGSMS has one web interface &#x2013; FGSMSBootstrap which utilizes the jQuery Ui; however, FGSMSBootstrap is built upon a twitter bootstrap package for a more updated look that is meant to be more aesthetically pleasing for the user. </p></div>
<div class="section">
<h2><a name="FGSMSBootstrap"></a>FGSMSBootstrap</h2>
<p>Most of FGSMSBootstrap&#x2019;s pages are categorized within their WebPages folder. Because the interfaces use ajax heavily, all new pages are inserted within the &#x201c;mainpane&#x201d; div in the index.jsp, making the &#x201c;back&#x201d; button on the browser useless (it would redirect the user to the login page). In this UI, we have a breadcrumbing system located in the footer section of index.jsp to keep track of the user&#x2019;s progress through our website.</p>
<p>Most functionality of breadcrumbing and ajaxing are in main.js. Of them all, the three noteworthy ones are: loadpage, postBack, and postBackReRender.</p>
<p>Loadpage: load the page within the specific div container postBack: post back to the server with the data and write out the response to the resultBar. postBackReRender: post back to the server and rerender the current page</p>
<p>In order to update the breadcrumbing, add an optional last parameter that tracks the &#x201c;parent&#x201d; pages or the history of the user&#x2019;s progress.</p>
<p>Also, it is important to note that all pages are relative to index.jsp file which contains the outline of the pages (header/mainpane/footer+breadcrumbing). So, for instance, if you are editing the &#x201c;js/scheduledReports/scheduledReportsScript.js&#x201d; and are trying to access the &#x201c;reporting/scheduledReportsEditFunctionality.jsp&#x201d; file, you do not have to write &#x201c;&#x2026;/&#x2026;/reporting/scheduledReportsEditFunctionality.jsp,&#x201d; you can simply write &#x201c;reporting/scheduledReportsEditFunctionality.jsp.&#x201d;</p>
<p>Be wary of mixing jQuery UI within twitter bootstrap as not everything is compatible. For more information on twitter bootstrap specifically, go to the homepage at: <a class="externalLink" href="http://twitter.github.com/bootstrap/">http://twitter.github.com/bootstrap/</a></p></div>
<div class="section">
<h2><a name="Notable_APIs_-_Java"></a>Notable APIs - Java</h2>

<ul>
  
<li>FGSMS.Common has a multitude of commonly used functions within FGSMS. The following is a list of useful APIs that you may need if extending FGSMS to meet a new need.</li>
  
<li>UserIdentUtil &#x2013; Provides access control decisions based on the permission structure within the configuration database</li>
  
<li>Utility &#x2013; Provides a number of string and conversion tools, database connection functions, audit logging, IP utilities and encryption tools</li>
  
<li>FGSMS.AgentCore &#x2013; This jar provides all of the necessary functionality to monitor traffic and report back to the FGSMS services.</li>
  
<li>Message Processor &#x2013; receives messages from agents and controls the threading of the DataPusher</li>
  
<li>DataPusher &#x2013; handles configuration loading, dynamic discovery, service policy loading and enforcement, and acts as the call back mechanism to the FGSMS services (PCS and DCS)</li>
  
<li>.NET - Message Processor (Transactional Agents)</li>
  
<li>.NET - ConfigLoader loads configuration information and client proxies for all of the FGSMS services</li>
  
<li>.NET - Windows Service Monitor - Provides monitoring of Windows Services, Hard Drive space and IIS Applications Pools. Provides a good example of setting the status of items.</li>
  
<li>Java - Message Processor (Transactional Agents)</li>
  
<li>Java - Utility, contains encryption/decryption classes, various helper functions</li>
  
<li>Java - IPAddressUtility, resolves urls to &#x2018;modified&#x2019; unique URLs that are used by FGSMS</li>
  
<li>Java - UserIdentityUtil, identifies user names from context variables and provides access control decisions for FGSMS&#x2019;s services</li>
  
<li>Java - *Helper, provides wrappers around accessing the FGSMS services that provide some degree of reliabilty</li>
  
<li>Java - Agent Core, provides a wide array of helper functions for writing your own agents</li>
</ul></div>
<div class="section">
<h2><a name="Known_Issues_and_Limitations"></a>Known Issues and Limitations</h2>
<p>The FGSMS .NET WCF Agent is triggered after security processing is completed, thus any faults related to security validation failure will not be logged or alerted.</p></div>
<div class="section">
<h2><a name="Updating_the_look_and_feel_of_the_user_interface_Bootstrap"></a>Updating the look and feel of the user interface (Bootstrap)</h2>
<p>FGSMS uses <a class="externalLink" href="http://getbootstrap.com/2.3.2/">Twitter&#x2019;s Bootstrap</a> for UI theming. There&#x2019;s tons of plugins available for it and changing the color scheme is fairly easy to do. Just remember it&#x2019;s still on version v2 and not the latest and greatest.</p>
<h1>Using the FGSMS Web Services</h1>
<p>To make integration easier, all of the WSDLs, XSDs, and interface code are fairly well documented.</p>
<p>You&#x2019;ll want to use the following maven artifact for a quick win.</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">groupId `org.mil-oss`
artifactId `fgsms-common-interfaces`
</pre></div></div>
<p>Where to go from here really depends on your use case but the CLI is a great place to start.</p></div>
<div class="section">
<h2><a name="Building_an_agent"></a>Building an agent</h2>

<div class="source">
<div class="source"><pre class="prettyprint linenums">groupId `org.mil-oss`
artifactId `fgsms-agent-core`
</pre></div></div>
<p>And see the <i>Helper</i> classes as well as the <tt>MessageProcessor</tt>.</p>
<p>The Policy Configuration Service provides access to both global and service specific policies as well as viewing and changing permissions. Consult WSDL and code documentation for the permissions required to execute each action.</p>
<p>The Data Collector Service (DCS) acts as a collection point for service invocation metrics. It is exclusively accessed by authorized FGSMS Agents. </p></div>
<div class="section">
<h2><a name="Looking_to_extract_data"></a>Looking to extract data</h2>
<p>The Policy Configuration Service provides access to both global and service specific policies as well as viewing and changing permissions. Consult WSDL and code documentation for the permissions required to execute each action.</p>
<p>The Data Access Service (DAS) provides access to most common queries, such as a verage performance statistics over a given period of time. Consult WSDL and code documentation for the permissions required to execute each action. </p>
<p>The Status Service (SS) will tell you what is up and what is not on demand.</p>
<p>The Reporting Service provides the ability to custom tailor a HTML encoded report for a set of services, over a given period of time, for a given set of report types. </p>
<p>The Automated Reporting Service provides the ability to define reporting jobs and to retrieve the listing of completed reports that are available for pickup via the Report Fetcher servlet.</p>
<p><a href="permissions.md">Access control rules apply</a></p>
<h1>More Examples</h1></div>
<div class="section">
<h2><a name="Write_your_own_application_to_receive_alerts"></a>Write your own application to receive alerts</h2>
<p>TODO This section is incomplete.</p>
<p>Alerts in FGSMS are processed via two components</p>

<ul>
  
<li>Transactional SLA Processor - handles all directly measured SLA Rules</li>
  
<li>Non-transactional SLA Processor - handles all aggregated/calculated over time SLA Rules</li>
</ul>
<p>When an SLA rule is triggered (resolves to true), the SLA Actions are processed. FGSMS has a number of SLA Actions built via the plugin system. Here&#x2019;s a few examples.</p>

<ul>
  
<li>Send a <a class="externalLink" href="https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=wsdm">WSDM</a> alert via WS-Notification</li>
  
<li>Send a <a class="externalLink" href="https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=wsdm">WSDM</a> alert via HornetQ JMS broker</li>
  
<li>Send a <a class="externalLink" href="https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=wsdm">WSDM</a> alert via AMQP Qpid JMS broker</li>
</ul>
<p>If you read between the lines, all of these are publish and subscribe mechanisms. We didn&#x2019;t want to reinvent the wheel. Here&#x2019;s the general steps required (which will vary based on the alerting mechanism you choose).</p>

<ol style="list-style-type: decimal">
  
<li>Configure FGSMS&#x2019;s server (User interface &gt; Administrator &gt; General Settings)</li>
  
<li>Edit the service policy for the service you want alerts on.</li>
  
<li>Add a SLA to that service policy with the actions set to your desired action plugin</li>
  
<li>Save it</li>
  
<li>Develop an application that communicates to the same alerting mechanism as the action plugin.</li>
  
<li>Subscribe to that action plugin&#x2019;s pub/sub mechanism</li>
  
<li>Test by purposely causing the SLA Rule from step 3 to trigger.</li>
</ol>
<p>There are many examples using a number of mechanisms in the <tt>fgsms.tests</tt> directory, labeled as <tt>Smoke Tests</tt>. These tests are ran on every build in order to ensure that everything is functional via the alerting plugins. As such, they are great starting points for an example on how to integrate with and test against the various systems FGSMS interoperates with.</p>
<h1>Future documentation</h1>

<ul>
  
<li>Create a new Quartz Job, such as a polling agent, or something that exports data on a periodic basis.</li>
  
<li>Add new functionality to the user interface</li>
</ul></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">

        </div>
        </div>
    </footer>
    </body>
</html>
